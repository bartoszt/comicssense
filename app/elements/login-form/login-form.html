<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-element.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-login.html">

<polymer-element name="login-form" attributes="">
    <template>        
        <link rel="stylesheet" href="login-form.css">
         
        <firebase-login id="baseLogin" user="{{user}}" params="{{baseLoginParams}}" statusKnown="{{statusKnown}}" location="https://comicsense.firebaseio.com/users" provider="password" on-login="{{onLogin}}" on-error="{{onLoginError}}" on-user-created="{{userCreated}}"></firebase-login>
        <firebase-login id="facebookLogin" user="{{user}}" statusKnown="{{statusKnown}}" location="https://comicsense.firebaseio.com/users" provider="facebook"></firebase-login>
        <firebase-login id="githubLogin" user="{{user}}" statusKnown="{{statusKnown}}" location="https://comicsense.firebaseio.com/users" provider="github"></firebase-login>
        <firebase-login id="googleLogin" user="{{user}}" statusKnown="{{statusKnown}}" location="https://comicsense.firebaseio.com/users" provider="google"></firebase-login>
        <firebase-login id="twitterLogin" user="{{user}}" statusKnown="{{statusKnown}}" location="https://comicsense.firebaseio.com/users" provider="twitter"></firebase-login>
   
        <pvc-globals values="{{globals}}"></pvc-globals>
        
        <div id="loginFormWrapper" hidden?="{{!statusKnown || user}}">
            <div id="errorContainer"></div>
            
            <form id="loginForm" layout horizontal center>
                <label for="s_loginInput">E-mail</label>
                <input type="text" id="s_loginInput" value="{{email}}" placeholder="E-mail address" />

                <label for="s_passwordInput">Password</label>
                <input type="password" id="s_passwordInput" value="{{password}}" placeholder="Password" />

                <input type="button" value="Sign in" on-click="{{signinAction}}" />
                <input type="button" value="Registration" on-click="{{switchViewAction}}"  />
            </form>

            <form id="registerForm" layout horizontal center>
                <label for="loginInput">Email</label>
                <input type="text" id="r_loginInput" value="{{rEmail}}" placeholder="E-mail address" />

                <label for="passwordInput">Password</label>
                <input type="password" id="r_passwordInput" value="{{rPassword}}" placeholder="Password" />

                <input type="button" value="Register" on-click="{{registerAction}}" />
                <input type="button" value="Sign in" on-click="{{switchViewAction}}" />
            </form>
            
            <ul>
                <li><input type="button" value="Login with Facebook" on-click="{{signinFacebook}}" /></li>
                <li><input type="button" value="Login with Google" on-click="{{signinGoogle}}" /></li>
                <li><input type="button" value="Login with Twitter" on-click="{{signinTwitter}}" /></li>
                <li><input type="button" value="Login with Github" on-click="{{signinGithub}}" /></li>
            </ul>
        </div>
        <div id="loggedIn" hidden?="{{!statusKnown || !user}}">
            Hello {{globals.currentUser.auth.uid}}!
            <button on-click="{{logout}}">Logout</button>
        </div>
    </template>
    <script>
    (function () {

      Polymer({  
        baseLoginParams : {},
        provider : {},
        domReady : function () {        
        },
        signinAction : function () {        
            this.provider = "password";         
            this.$.baseLogin.login({'email':this.email, 'password':this.password});     
            return false;
        },
        registerAction : function () {             
            this.$.baseLogin.createUser(this.rEmail,this.rPassword);
            console.log('register log');
        },          
        switchViewAction : function () {         
            $(this.$.loginFormWrapper).toggleClass('register-state');
        },
          
        // sign in by Social hub  
        signinFacebook : function () {      
            this.$.facebookLogin.login();
            console.log('test');
        },
        signinGoogle : function () {    
            this.$.googleLogin.login();            
        },
        signinGithub : function () {          
            this.$.githubLogin.login();
        },
        signinTwitter : function () {  
            this.$.twitterLogin.login();
        },
          
        onLogin : function() {
            this.globals.currentUser = this.user; 
            document.querySelector('app-router').go('/scene');
        },
        onLoginError : function (err) {
            console.log("An error occured.", err);
            this.statusKnown = true;
            this.$.errorContainer.innerHTML = err.detail; 
        },
        userCreated : function () {
            this.$.baseLogin.login({'email':this.rEmail, 'password':this.rPassword});   
            console.log("userCreated"); 
        },
        logout : function () {  
            switch(this.globals.currentUser.provider) {
                case 'password':                         
                    this.$.baseLogin.logout();
                break;

                case 'facebook': 
                    this.$.facebookLogin.logout();                    
                break;

                case 'google':                    
                    this.$.googleLogin.logout();
                break;

                case 'twitter':                    
                    this.$.twitterLogin.logout();
                break;

                case 'github':                     
                    this.$.githubLogin.logout();
                break;
                
                default:
                    console.log("logout failed");
            }
        }
      });

    })();
    </script>
</polymer-element>